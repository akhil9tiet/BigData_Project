{"paragraphs":[{"text":"%md\n# Basic data manipulations\n","dateUpdated":"2017-12-05T01:38:15+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","results":{},"enabled":true,"editorSetting":{"language":"markdown","editOnDblClick":true}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Basic data manipulations</h1>\n"}]},"apps":[],"jobName":"paragraph_1512437895642_1777448896","id":"20171203-230935_488745930","dateCreated":"2017-12-05T01:38:15+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:174"},{"text":"%pyspark\nfrom pyspark.sql.functions import *\nfrom pyspark.sql.functions import to_timestamp\nfrom pyspark.sql.types import DateType\n","dateUpdated":"2017-12-05T01:44:21+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1512437895647_1775525151","id":"20171203-231136_786455479","dateCreated":"2017-12-05T01:38:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:175","user":"anonymous","dateFinished":"2017-12-05T01:44:21+0000","dateStarted":"2017-12-05T01:44:21+0000"},{"text":"%pyspark\nbikedata=spark.read.csv(\"s3://bikesharebigdata/2017-Q1-Trips-History-Data.csv\",header=True, timestampFormat=\"%m/%d/%Y %H:%M\", inferSchema= \"True\")\n\ndf = bikedata.select(col(\"Duration\").alias(\"Duration\"), \n                     col(\"Start date\").alias(\"StartDate\"), \n                     col(\"End date\").alias(\"EndDate\"),\n                     col(\"Start station\").alias(\"StartStation\"),\n                     col(\"End station\").alias(\"EndStation\"),\n                     col(\"Bike number\").alias(\"BikeNumber\"),\n                     col(\"Member type\").alias(\"MemberType\"))\n\n","user":"anonymous","dateUpdated":"2017-12-05T02:25:02+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1512438231032_-1101736038","id":"20171205-014351_28395906","dateCreated":"2017-12-05T01:43:51+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:584","dateFinished":"2017-12-05T01:44:39+0000","dateStarted":"2017-12-05T01:44:25+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\n\ndf.printSchema()\ndf.show()","dateUpdated":"2017-12-05T01:59:09+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1512437895648_1761289442","id":"20171204-001815_170147795","dateCreated":"2017-12-05T01:38:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:176","user":"anonymous","dateFinished":"2017-12-05T01:59:17+0000","dateStarted":"2017-12-05T01:59:09+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- Duration: integer (nullable = true)\n |-- StartDate: string (nullable = true)\n |-- EndDate: string (nullable = true)\n |-- StartStation: string (nullable = true)\n |-- EndStation: string (nullable = true)\n |-- BikeNumber: string (nullable = true)\n |-- MemberType: string (nullable = true)\n\n+--------+---------------+---------------+--------------------+--------------------+----------+----------+\n|Duration|      StartDate|        EndDate|        StartStation|          EndStation|BikeNumber|MemberType|\n+--------+---------------+---------------+--------------------+--------------------+----------+----------+\n| 1048876|3/31/2017 23:59|  4/1/2017 0:17|      17th & K St NW|Potomac & Pennsyl...|    W20784|Registered|\n|  223449|3/31/2017 23:59|  4/1/2017 0:03|Adams Mill & Colu...|16th & Harvard St NW|    W20825|Registered|\n|  423494|3/31/2017 23:58|  4/1/2017 0:05|M St & Delaware A...|      11th & H St NE|    W20773|Registered|\n|  687015|3/31/2017 23:57|  4/1/2017 0:08|  9th & Upshur St NW|       8th & O St NW|    W01307|Registered|\n|  257919|3/31/2017 23:57|  4/1/2017 0:02|Park Rd & Holmead...|Georgia & New Ham...|    W21760|Registered|\n|  253959|3/31/2017 23:56|  4/1/2017 0:00| 14th & Girard St NW| 11th & Kenyon St NW|    W23036|Registered|\n|  402669|3/31/2017 23:56|  4/1/2017 0:03|      10th & K St NW|       7th & T St NW|    W22539|Registered|\n|  744377|3/31/2017 23:56|  4/1/2017 0:09|37th & O St NW / ...|N Lynn St & Fairf...|    W20893|    Casual|\n|  776845|3/31/2017 23:57|  4/1/2017 0:10|      10th & U St NW|  9th & Upshur St NW|    W00945|Registered|\n|  212823|3/31/2017 23:55|3/31/2017 23:58| 14th & Irving St NW|15th & Euclid St  NW|    W22998|Registered|\n|  338103|3/31/2017 23:55|  4/1/2017 0:00|      14th & R St NW|       7th & T St NW|    W20006|Registered|\n|  883046|3/31/2017 23:55|  4/1/2017 0:10|3000 Connecticut ...|      19th & L St NW|    W00382|    Casual|\n|  534500|3/31/2017 23:54|  4/1/2017 0:03|      10th & U St NW|      18th & R St NW|    W01141|Registered|\n|  384349|3/31/2017 23:54|  4/1/2017 0:00| 11th & Kenyon St NW|15th & Euclid St  NW|    W20333|Registered|\n|  844927|3/31/2017 23:52|  4/1/2017 0:06|      13th & H St NE|       7th & T St NW|    W01112|Registered|\n|  131407|3/31/2017 23:52|3/31/2017 23:54|      15th & P St NW|17th St & Massach...|    W22571|Registered|\n| 1671953|3/31/2017 23:51|  4/1/2017 0:18|Maryland & Indepe...|       4th & E St SW|    W21357|Registered|\n|  519264|3/31/2017 23:51|3/31/2017 23:59|5th St & Massachu...|17th St & Massach...|    W21581|Registered|\n| 1066202|3/31/2017 23:51|  4/1/2017 0:09|Union Market/6th ...|Columbia Rd & Geo...|    W21234|Registered|\n|  200303|3/31/2017 23:50|3/31/2017 23:53|Columbus Circle /...|       8th & F St NE|    W22146|Registered|\n+--------+---------------+---------------+--------------------+--------------------+----------+----------+\nonly showing top 20 rows\n\n"}]}},{"text":"%pyspark\n# Display the number of bikes\nresult = df.agg(countDistinct(df.BikeNumber)).collect()\nresult","user":"anonymous","dateUpdated":"2017-12-05T02:14:55+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1512438353306_1319255639","id":"20171205-014553_1249054844","dateCreated":"2017-12-05T01:45:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:826","dateFinished":"2017-12-05T02:14:43+0000","dateStarted":"2017-12-05T02:14:21+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[Row(count(DISTINCT BikeNumber)=4298)]\n"}]}},{"text":"%pyspark\n# Display the number of Bikes per Station per Day\n#result = df.select(\"StartDate\",\"StartStation\", count(\"BikeNumber\")).groupBy(\"StartDate\",\"StartStation\").agg(countDistinct(\"BikeNumber\")).collect()\n#result.take(10)","user":"anonymous","dateUpdated":"2017-12-05T02:24:54+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1512438305196_-83230723","id":"20171205-014505_2139633452","dateCreated":"2017-12-05T01:45:05+0000","status":"ERROR","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:672","dateFinished":"2017-12-05T02:23:31+0000","dateStarted":"2017-12-05T02:23:31+0000","results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Traceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-4020984739039306285.py\", line 367, in <module>\n    raise Exception(traceback.format_exc())\nException: Traceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-4020984739039306285.py\", line 355, in <module>\n    exec(code, _zcUserQueryNameSpace)\n  File \"<stdin>\", line 1, in <module>\n  File \"/usr/lib/spark/python/pyspark/sql/dataframe.py\", line 1040, in select\n    jdf = self._jdf.select(self._jcols(*cols))\n  File \"/usr/lib/spark/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1133, in __call__\n    answer, self.gateway_client, self.target_id, self.name)\n  File \"/usr/lib/spark/python/pyspark/sql/utils.py\", line 69, in deco\n    raise AnalysisException(s.split(': ', 1)[1], stackTrace)\nAnalysisException: u\"grouping expressions sequence is empty, and '`StartDate`' is not an aggregate function. Wrap '(count(`BikeNumber`) AS `count(BikeNumber)`)' in windowing function(s) or wrap '`StartDate`' in first() (or first_value) if you don't care which value you get.;;\\nAggregate [StartDate#94, StartStation#96, count(BikeNumber#98) AS count(BikeNumber)#260L]\\n+- Project [Duration#74 AS Duration#93, Start date#75 AS StartDate#94, End date#76 AS EndDate#95, Start station#78 AS StartStation#96, End station#80 AS EndStation#97, Bike number#81 AS BikeNumber#98, Member type#82 AS MemberType#99]\\n   +- Relation[Duration#74,Start date#75,End date#76,Start station number#77,Start station#78,End station number#79,End station#80,Bike number#81,Member Type#82] csv\\n\"\n\n"}]}},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2017-12-05T02:19:23+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1512440363228_866255110","id":"20171205-021923_1329059388","dateCreated":"2017-12-05T02:19:23+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1166"}],"name":"BikeShareData","id":"2D24KCBKT","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}