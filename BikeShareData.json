{"paragraphs":[{"text":"%md\n# Basic data manipulations\n","dateUpdated":"2017-12-05T17:27:35+0000","config":{"colWidth":12,"editorMode":"ace/mode/markdown","results":{},"enabled":true,"editorSetting":{"language":"markdown","editOnDblClick":true}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Basic data manipulations</h1>\n"}]},"apps":[],"jobName":"paragraph_1512494855122_-2147373211","id":"20171203-230935_488745930","dateCreated":"2017-12-05T17:27:35+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:256"},{"text":"%pyspark\nfrom pyspark.sql.functions import *\nfrom pyspark.sql.functions import to_timestamp\nfrom pyspark.sql.types import DateType\n\n\n","user":"anonymous","dateUpdated":"2017-12-07T11:11:59+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Traceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-25915188036592656.py\", line 367, in <module>\n    raise Exception(traceback.format_exc())\nException: Traceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-25915188036592656.py\", line 360, in <module>\n    exec(code, _zcUserQueryNameSpace)\n  File \"<stdin>\", line 4, in <module>\nImportError: No module named zeppelin.spark.sql.stacktrace\n\n"}]},"apps":[],"jobName":"paragraph_1512494855135_2142592350","id":"20171203-231136_786455479","dateCreated":"2017-12-05T17:27:35+0000","dateStarted":"2017-12-07T11:11:44+0000","dateFinished":"2017-12-07T11:11:44+0000","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:257"},{"text":"%pyspark\nbikedata=spark.read.csv(\"s3://bikesharebigdata/2017-Q1-Trips-History-Data.csv\",header=True, timestampFormat=\"%m/%d/%Y %H:%M\", inferSchema= \"True\")\n\ndf = bikedata.select(col(\"Duration\").alias(\"Duration\"), \n                     col(\"Start date\").alias(\"StartDate\"), \n                     col(\"End date\").alias(\"EndDate\"),\n                     col(\"Start station\").alias(\"StartStation\"),\n                     col(\"End station\").alias(\"EndStation\"),\n                     col(\"Bike number\").alias(\"BikeNumber\"),\n                     col(\"Member type\").alias(\"MemberType\"))\n\n","user":"anonymous","dateUpdated":"2017-12-05T17:32:38+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1512494855135_2142592350","id":"20171205-014351_28395906","dateCreated":"2017-12-05T17:27:35+0000","dateStarted":"2017-12-05T17:32:38+0000","dateFinished":"2017-12-05T17:32:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:258"},{"text":"%pyspark\n\ndf.printSchema()\ndf.show()","user":"anonymous","dateUpdated":"2017-12-07T10:22:55+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false},"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- Duration: integer (nullable = true)\n |-- StartDate: string (nullable = true)\n |-- EndDate: string (nullable = true)\n |-- StartStation: string (nullable = true)\n |-- EndStation: string (nullable = true)\n |-- BikeNumber: string (nullable = true)\n |-- MemberType: string (nullable = true)\n\n+--------+---------------+---------------+--------------------+--------------------+----------+----------+\n|Duration|      StartDate|        EndDate|        StartStation|          EndStation|BikeNumber|MemberType|\n+--------+---------------+---------------+--------------------+--------------------+----------+----------+\n| 1048876|3/31/2017 23:59|  4/1/2017 0:17|      17th & K St NW|Potomac & Pennsyl...|    W20784|Registered|\n|  223449|3/31/2017 23:59|  4/1/2017 0:03|Adams Mill & Colu...|16th & Harvard St NW|    W20825|Registered|\n|  423494|3/31/2017 23:58|  4/1/2017 0:05|M St & Delaware A...|      11th & H St NE|    W20773|Registered|\n|  687015|3/31/2017 23:57|  4/1/2017 0:08|  9th & Upshur St NW|       8th & O St NW|    W01307|Registered|\n|  257919|3/31/2017 23:57|  4/1/2017 0:02|Park Rd & Holmead...|Georgia & New Ham...|    W21760|Registered|\n|  253959|3/31/2017 23:56|  4/1/2017 0:00| 14th & Girard St NW| 11th & Kenyon St NW|    W23036|Registered|\n|  402669|3/31/2017 23:56|  4/1/2017 0:03|      10th & K St NW|       7th & T St NW|    W22539|Registered|\n|  744377|3/31/2017 23:56|  4/1/2017 0:09|37th & O St NW / ...|N Lynn St & Fairf...|    W20893|    Casual|\n|  776845|3/31/2017 23:57|  4/1/2017 0:10|      10th & U St NW|  9th & Upshur St NW|    W00945|Registered|\n|  212823|3/31/2017 23:55|3/31/2017 23:58| 14th & Irving St NW|15th & Euclid St  NW|    W22998|Registered|\n|  338103|3/31/2017 23:55|  4/1/2017 0:00|      14th & R St NW|       7th & T St NW|    W20006|Registered|\n|  883046|3/31/2017 23:55|  4/1/2017 0:10|3000 Connecticut ...|      19th & L St NW|    W00382|    Casual|\n|  534500|3/31/2017 23:54|  4/1/2017 0:03|      10th & U St NW|      18th & R St NW|    W01141|Registered|\n|  384349|3/31/2017 23:54|  4/1/2017 0:00| 11th & Kenyon St NW|15th & Euclid St  NW|    W20333|Registered|\n|  844927|3/31/2017 23:52|  4/1/2017 0:06|      13th & H St NE|       7th & T St NW|    W01112|Registered|\n|  131407|3/31/2017 23:52|3/31/2017 23:54|      15th & P St NW|17th St & Massach...|    W22571|Registered|\n| 1671953|3/31/2017 23:51|  4/1/2017 0:18|Maryland & Indepe...|       4th & E St SW|    W21357|Registered|\n|  519264|3/31/2017 23:51|3/31/2017 23:59|5th St & Massachu...|17th St & Massach...|    W21581|Registered|\n| 1066202|3/31/2017 23:51|  4/1/2017 0:09|Union Market/6th ...|Columbia Rd & Geo...|    W21234|Registered|\n|  200303|3/31/2017 23:50|3/31/2017 23:53|Columbus Circle /...|       8th & F St NE|    W22146|Registered|\n+--------+---------------+---------------+--------------------+--------------------+----------+----------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1512494855135_2142592350","id":"20171204-001815_170147795","dateCreated":"2017-12-05T17:27:35+0000","dateStarted":"2017-12-05T17:33:26+0000","dateFinished":"2017-12-05T17:33:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:259"},{"text":"%pyspark\n# Display the number of bikes\nresult = df.agg(countDistinct(df.BikeNumber)).collect()\nresult","dateUpdated":"2017-12-05T17:27:35+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[Row(count(DISTINCT BikeNumber)=4298)]\n"}]},"apps":[],"jobName":"paragraph_1512494855136_2128356640","id":"20171205-014553_1249054844","dateCreated":"2017-12-05T17:27:35+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:260"},{"text":"%pyspark\n# Display the number of Bikes per Station upto the minute\n#result = df.select(\"StartDate\",\"StartStation\", \"BikeNumber\").groupBy(\"StartDate\",\"StartStation\").agg(countDistinct(\"BikeNumber\")).show()\n# Display the number of Bikes per Station per day\n#df.withColumn('StartDate_Date', df['StartDate'].substr(1, 9)).groupby('StartDate_Date', 'StartStation').agg(countDistinct(\"BikeNumber\")).show()\nresult = df.withColumn('StartDate_Date', df['StartDate'].substr(1, 9)).groupby('StartStation').agg(countDistinct(\"BikeNumber\")).sort(countDistinct(\"BikeNumber\"), ascending=False).show()","user":"anonymous","dateUpdated":"2017-12-07T10:52:52+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+--------------------------+\n|        StartStation|count(DISTINCT BikeNumber)|\n+--------------------+--------------------------+\n|Columbus Circle /...|                      3446|\n|Massachusetts Ave...|                      3256|\n|      15th & P St NW|                      3121|\n|    Lincoln Memorial|                      3020|\n|       Thomas Circle|                      2991|\n|Jefferson Dr & 14...|                      2960|\n|      14th & V St NW|                      2903|\n|New Hampshire Ave...|                      2835|\n|       5th & K St NW|                      2798|\n|       1st & M St NE|                      2716|\n|North Capitol St ...|                      2680|\n|14th & Rhode Isla...|                      2671|\n|  Jefferson Memorial|                      2642|\n|Eastern Market Me...|                      2641|\n|17th & Corcoran S...|                      2604|\n|Adams Mill & Colu...|                      2549|\n|       8th & O St NW|                      2524|\n|       8th & H St NW|                      2513|\n|      21st & M St NW|                      2509|\n|      14th & R St NW|                      2499|\n+--------------------+--------------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1512494855136_2128356640","id":"20171205-014505_2139633452","dateCreated":"2017-12-05T17:27:35+0000","dateStarted":"2017-12-07T10:52:17+0000","dateFinished":"2017-12-07T10:52:44+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:261"},{"text":"%sql\nselect StartStation from df","user":"anonymous","dateUpdated":"2017-12-07T11:11:14+0000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1512643682391_-173132540","id":"20171207-104802_25672242","dateCreated":"2017-12-07T10:48:02+0000","status":"ERROR","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1518","dateFinished":"2017-12-07T11:11:14+0000","dateStarted":"2017-12-07T11:11:14+0000","results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Table or view not found: df; line 1 pos 25\nset zeppelin.spark.sql.stacktrace = true to see full stacktrace"}]}},{"text":"%pyspark\n#Average Traffic per StartStaion\n#df.select(\"StartStation\", \"BikeNumber\").groupby(\"StartStation\").agg(avg(count(\"BikeNumber\"))).show()\n#df.select('StartStation',count(\"BikeNumber\")).groupby(\"StartStation\").agg(avg(count(\"BikeNumber\"))).show()\ndf.select('StartStation',count(\"BikeNumber\")).groupby(\"StartStation\").agg(avg(count(\"BikeNumber\"))).show()","user":"anonymous","dateUpdated":"2017-12-05T21:19:07+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Traceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-25915188036592656.py\", line 367, in <module>\n    raise Exception(traceback.format_exc())\nException: Traceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-25915188036592656.py\", line 360, in <module>\n    exec(code, _zcUserQueryNameSpace)\n  File \"<stdin>\", line 1, in <module>\n  File \"/usr/lib/spark/python/pyspark/sql/dataframe.py\", line 1040, in select\n    jdf = self._jdf.select(self._jcols(*cols))\n  File \"/usr/lib/spark/python/lib/py4j-0.10.4-src.zip/py4j/java_gateway.py\", line 1133, in __call__\n    answer, self.gateway_client, self.target_id, self.name)\n  File \"/usr/lib/spark/python/pyspark/sql/utils.py\", line 69, in deco\n    raise AnalysisException(s.split(': ', 1)[1], stackTrace)\nAnalysisException: u\"grouping expressions sequence is empty, and '`StartStation`' is not an aggregate function. Wrap '(avg(count(`BikeNumber`)) AS `avg(count(BikeNumber))`)' in windowing function(s) or wrap '`StartStation`' in first() (or first_value) if you don't care which value you get.;;\\nAggregate [StartStation#34, avg(count(BikeNumber#36)) AS avg(count(BikeNumber))#293]\\n+- Project [Duration#12 AS Duration#31, Start date#13 AS StartDate#32, End date#14 AS EndDate#33, Start station#16 AS StartStation#34, End station#18 AS EndStation#35, Bike number#19 AS BikeNumber#36, Member type#20 AS MemberType#37]\\n   +- Relation[Duration#12,Start date#13,End date#14,Start station number#15,Start station#16,End station number#17,End station#18,Bike number#19,Member Type#20] csv\\n\"\n\n"}]},"apps":[],"jobName":"paragraph_1512494855137_2127971891","id":"20171205-021923_1329059388","dateCreated":"2017-12-05T17:27:35+0000","dateStarted":"2017-12-05T21:18:55+0000","dateFinished":"2017-12-05T21:18:55+0000","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:262"},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2017-12-05T19:56:00+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1512503760880_-604718789","id":"20171205-195600_1956440245","dateCreated":"2017-12-05T19:56:00+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:263"}],"name":"BikeShareData","id":"2D11KVVXG","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}